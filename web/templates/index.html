<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìä</text></svg>">
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="flex flex-col h-screen overflow-hidden bg-slate-100 text-slate-800">
  <!-- Knowledge Question Line -->
  <a href="https://eu.startpage.com/do/search?query={{ .KnowledgeBit.SearchTerm }}&prfe=db7782ffde7fc79026fcb9735ac3535a747ab9ae506bd316fbf78e424aff11e676a57e10ca121690e7b0d2ec79120910731385a4b54d5594392332a723762ed80f8309e90a25723e0c7ec13059fe9f" target="_blank" rel="noopener noreferrer"
    class="block text-center py-2 text-sm text-blue-600 hover:text-blue-800 hover:underline bg-white border-b border-slate-300 flex-shrink-0">
    {{ .KnowledgeBit.Question }}
  </a>

  <!-- Main Content Area -->
  <div
    class="flex-1 min-h-0 overflow-y-auto overflow-x-hidden grid gap-[2px] grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 auto-rows-max lg:auto-rows-fr p-[2px]"
    data-count="{{ len .Sources }}">
    {{ if .Sources }}
    {{ range .Sources }}
    <div class="bg-white border border-slate-300 flex flex-col lg:min-h-0" {{ if .NSFW
      }}style="background-color: #fff5f5; border-color: #cf222e;" {{ else if .IgnoreDays
      }}style="background-color: #fff8e6; border-color: #e3a008;" {{ else }}style="background-color: #fff;" {{ end }}>
      <div
        class="px-3 py-2 border-b flex-shrink-0 flex justify-between items-center text-[12px] font-bold uppercase tracking-wider"
        {{ if .NSFW }}style="background-color: #fff5f5; border-bottom-color: #cf222e; color: #82071e;" {{ else if
        .IgnoreDays }}style="background-color: #fff8e6; border-bottom-color: #e3a008; color: #92400e;" {{ else
        }}style="background-color: #f6f8fa; border-bottom-color: #d0d7de;" {{ end }}>
        <span>{{ .Name }}</span>
        <span class="text-[10px] font-normal opacity-70">{{ if .IgnoreDays }}‚àû{{ else }}{{ .Days }}d{{ end }}</span>
      </div>
      <div class="flex-1 min-h-0 lg:overflow-y-auto p-2">
        {{ if .Error }}
        <div class="rounded p-4 m-4 flex gap-3" style="background-color: #fff1f0; border: 1px solid #ff8182;">
          <div class="text-[24px] flex-shrink-0">‚ö†Ô∏è</div>
          <div class="text-[12px] leading-relaxed break-words" style="color: #d1242f;">{{ .Error }}</div>
        </div>
        {{ else if .Items }}
        {{ range .Items }}
        <div class="border-l-2 p-2 mb-2 transition-colors hover:border-blue-600 hover:bg-slate-100"
          style="border-left-color: #d0d7de;">
          <div class="text-[13px] mb-1">
            <a href="{{ .Link }}" target="_blank" rel="noopener noreferrer" style="color: #0550ae;">{{ .Title }}</a>
          </div>
          {{ if not .HideDate }}
          <div class="text-[10px]" style="color: #57606a;">{{ formatTimeAgo .Published }}</div>
          {{ end }}
        </div>
        {{ end }}
        {{ else }}
        <div class="text-center py-10" style="color: #57606a;">No items</div>
        {{ end }}
      </div>
    </div>
    {{ end }}
    {{ else }}
    <div class="tile bg-white border border-slate-300">
      <div class="tile-content p-2 flex-1">
        <div class="empty text-center text-slate-500 py-10">No sources configured</div>
      </div>
    </div>
    {{ end }}
  </div>
  <script>
    const eventSource = new EventSource('/events');

    eventSource.onmessage = function(event) {
      if (event.data === 'update') {
        window.location.reload();
      }
    };

    eventSource.onerror = function(error) {
      console.error('SSE error:', error);
      setTimeout(() => {
        window.location.reload();
      }, 5000);
    };
  </script>
</body>

</html>
