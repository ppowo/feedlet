<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìä</text></svg>">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            java: '#d4a574',
            jquery: '#54aeff',
            modern: '#b392f0',
            jsp: '#f7931e'
          }
        }
      }
    }
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
  <style>
    .knowledge-code {
      line-height: 1.1 !important;
    }
  </style>
</head>

<body class="h-screen overflow-hidden flex font-mono bg-slate-100 text-slate-800">
  <!-- Left Sidebar: Knowledge Section -->
  <div class="w-[600px] flex flex-col border-r border-blue-600 overflow-hidden bg-white"
    x-data="{ activeTab: '{{ .ActiveTab }}' }">
    <!-- Tab Navigation -->
    <div class="flex border-b border-slate-300">
      <button @click="activeTab = 'java'"
        class="flex-1 px-4 py-2 text-[10px] font-bold uppercase tracking-wider transition-colors hover:bg-slate-50"
        :class="activeTab === 'java' ? 'border-b-2 border-java bg-java/20 text-slate-700' : 'text-slate-500'">
        Java
      </button>
      <button @click="activeTab = 'jquery'"
        class="flex-1 px-4 py-2 text-[10px] font-bold uppercase tracking-wider transition-colors hover:bg-slate-50"
        :class="activeTab === 'jquery' ? 'border-b-2 border-jquery bg-jquery/20 text-slate-700' : 'text-slate-500'">
        jQuery
      </button>
      <button @click="activeTab = 'jsp'"
        class="flex-1 px-4 py-2 text-[10px] font-bold uppercase tracking-wider transition-colors hover:bg-slate-50"
        :class="activeTab === 'jsp' ? 'border-b-2 border-jsp bg-jsp/20 text-slate-700' : 'text-slate-500'">
        JSP
      </button>
    </div>

    <!-- Content -->
    <div class="flex-1 overflow-auto p-3 flex items-center justify-center">
      <!-- Java Content -->
      <div class="w-full flex flex-col gap-2" x-show="activeTab === 'java'">
        <div class="text-[8px] uppercase tracking-wider text-slate-600">{{ .JavaBit.Category }}</div>
        <div class="font-bold text-[10px] leading-tight text-slate-700">{{ .JavaBit.Title }}</div>
        <div class="text-[9px] leading-tight text-slate-600">{{ .JavaBit.Description }}</div>
        {{ with .JavaBit.Code }}
        <pre
          class="knowledge-code bg-slate-50 p-2 rounded border-l-4 border-java text-[8px] whitespace-pre-wrap break-words shadow-sm"><code class="language-java">{{ . }}</code></pre>
        {{ end }}
      </div>

      <!-- jQuery Content -->
      <div class="w-full flex flex-col gap-2" x-show="activeTab === 'jquery'">
        <div class="text-[8px] uppercase tracking-wider text-slate-600">{{ .JQueryBit.Category }}</div>
        <div class="font-bold text-[10px] leading-tight text-slate-700">{{ .JQueryBit.Title }}</div>
        <div class="text-[9px] leading-tight text-slate-600 mb-2">{{ .JQueryBit.Description }}</div>
        {{ with .JQueryBit.JQueryCode }}<div class="mb-3">
          <div class="text-[8px] uppercase tracking-wider text-slate-600 mb-1">jQuery</div>
          <pre
            class="knowledge-code bg-slate-50 p-2 rounded border-l-4 border-jquery text-[8px] whitespace-pre-wrap break-words shadow-sm"><code class="language-javascript">{{ . }}</code></pre>
        </div>{{ end }}
        {{ with .JQueryBit.HTMLCode }}<div class="mb-3">
          <div class="text-[8px] uppercase tracking-wider text-slate-600 mb-1">HTML</div>
          <pre
            class="knowledge-code bg-slate-50 p-2 rounded border-l-4 border-modern text-[8px] whitespace-pre-wrap break-words shadow-sm"><code class="language-html">{{ . }}</code></pre>
        </div>{{ end }}
        {{ with .JQueryBit.ModernCode }}<div class="mb-3">
          <div class="text-[8px] uppercase tracking-wider text-slate-600 mb-1">Modern</div>
          <pre
            class="knowledge-code bg-slate-50 p-2 rounded border-l-4 border-modern text-[8px] whitespace-pre-wrap break-words shadow-sm"><code class="language-javascript">{{ . }}</code></pre>
        </div>{{ end }}
      </div>

      <!-- JSP Content -->
      <div class="w-full flex flex-col gap-2" x-show="activeTab === 'jsp'">
        <div class="text-[8px] uppercase tracking-wider text-slate-600">{{ .JSPBit.Category }}</div>
        <div class="font-bold text-[10px] leading-tight text-slate-700">{{ .JSPBit.Title }}</div>
        <div class="text-[9px] leading-tight text-slate-600">{{ .JSPBit.Description }}</div>
        {{ with .JSPBit.Code }}
        <pre
          class="knowledge-code bg-slate-50 p-2 rounded border-l-4 border-jsp text-[8px] whitespace-pre-wrap break-words shadow-sm"><code class="language-java">{{ . }}</code></pre>
        {{ end }}
      </div>
    </div>
  </div>
  <!-- Main Content Area -->
  <div class="flex-1 min-h-0 overflow-auto grid gap-[2px] grid-cols-3 md:grid-cols-4" data-count="{{ len .Sources }}">
    {{ if .Sources }}
    {{ range .Sources }}
    <div class="bg-white border border-slate-300 flex flex-col overflow-hidden" {{ if .NSFW
      }}style="background-color: #fff5f5; border-color: #cf222e;" {{ else if .IgnoreDays
      }}style="background-color: #fff8e6; border-color: #e3a008;" {{ else }}style="background-color: #fff;" {{ end }}>
      <div class="px-3 py-2 border-b flex justify-between items-center text-[12px] font-bold uppercase tracking-wider"
        {{ if .NSFW }}style="background-color: #fff5f5; border-bottom-color: #cf222e; color: #82071e;" {{ else if
        .IgnoreDays }}style="background-color: #fff8e6; border-bottom-color: #e3a008; color: #92400e;" {{ else
        }}style="background-color: #f6f8fa; border-bottom-color: #d0d7de;" {{ end }}>
        <span>{{ .Name }}</span>
        <span class="text-[10px] font-normal opacity-70">{{ if .IgnoreDays }}‚àû{{ else }}{{ .Days }}d{{ end }}</span>
      </div>
      <div class="flex-1 overflow-y-auto p-2">
        {{ if .Error }}
        <div class="rounded p-4 m-4 flex gap-3" style="background-color: #fff1f0; border: 1px solid #ff8182;">
          <div class="text-[24px] flex-shrink-0">‚ö†Ô∏è</div>
          <div class="text-[12px] leading-relaxed break-words" style="color: #d1242f;">{{ .Error }}</div>
        </div>
        {{ else if .Items }}
        {{ range .Items }}
        <div class="border-l-2 p-2 mb-2 transition-colors hover:border-blue-600 hover:bg-slate-100"
          style="border-left-color: #d0d7de;">
          <div class="text-[13px] mb-1">
            <a href="{{ .Link }}" target="_blank" rel="noopener noreferrer" style="color: #0550ae;">{{ .Title }}</a>
          </div>
          {{ if not .HideDate }}
          <div class="text-[10px]" style="color: #57606a;">{{ formatTimeAgo .Published }}</div>
          {{ end }}
        </div>
        {{ end }}
        {{ else }}
        <div class="text-center py-10" style="color: #57606a;">No items</div>
        {{ end }}
      </div>
    </div>
    {{ end }}
    {{ else }}
    <div class="tile bg-white border border-slate-300">
      <div class="tile-content p-2 flex-1">
        <div class="empty text-center text-slate-500 py-10">No sources configured</div>
      </div>
    </div>
    {{ end }}
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script>
    hljs.highlightAll();
    const eventSource = new EventSource('/events');

    eventSource.onmessage = function(event) {
      if (event.data === 'update') {
        window.location.reload();
      }
    };

    eventSource.onerror = function(error) {
      console.error('SSE error:', error);
      setTimeout(() => {
        window.location.reload();
      }, 5000);
    };
  </script>
</body>

</html>