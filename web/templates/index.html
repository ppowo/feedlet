<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìä</text></svg>">
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="flex h-screen flex-col overflow-hidden bg-slate-100 text-slate-900 antialiased">
  <!-- Knowledge Question Line -->
  <a href="https://eu.startpage.com/do/search?query={{ .KnowledgeBit.SearchTerm }}&prfe=db7782ffde7fc79026fcb9735ac3535a747ab9ae506bd316fbf78e424aff11e676a57e10ca121690e7b0d2ec79120910731385a4b54d5594392332a723762ed80f8309e90a25723e0c7ec13059fe9f" target="_blank" rel="noopener noreferrer"
    class="block flex-shrink-0 border-b border-slate-300 bg-slate-50 py-1.5 text-center text-[11px] text-sky-800 hover:text-sky-900 hover:underline">
    {{ .KnowledgeBit.Question }}
  </a>

  <!-- Main Content Area -->
  <div
    class="grid flex-1 min-h-0 auto-rows-max grid-cols-1 gap-1 overflow-x-hidden overflow-y-auto p-1 sm:grid-cols-2 lg:auto-rows-fr lg:grid-cols-3 xl:grid-cols-4"
    data-count="{{ len .Sources }}">
    {{ if .Sources }}
    {{ range .Sources }}
    <div class="flex flex-col rounded-sm border border-slate-300 border-l-4 bg-slate-50 shadow-sm lg:min-h-0 {{ if .NSFW }}border-l-rose-500{{ else if .IsChronological }}border-l-emerald-500{{ else if .IgnoreDays }}border-l-amber-500{{ else }}border-l-slate-400{{ end }}">
      <div class="flex flex-shrink-0 items-center justify-between gap-1.5 border-b border-slate-300 bg-slate-100 px-2 py-1.5">
        <div class="flex min-w-0 items-center gap-1.5">
          <span class="truncate text-[11px] font-semibold text-slate-800">{{ .Name }}</span>
          {{ if .NSFW }}
          <span title="NSFW" class="inline-block h-2 w-2 rounded-full bg-rose-500"></span>
          {{ else if .IsChronological }}
          <span title="Chronological" class="inline-block h-2 w-2 rounded-full bg-emerald-500"></span>
          {{ else if .IgnoreDays }}
          <span title="Timeless" class="inline-block h-2 w-2 rounded-full bg-amber-500"></span>
          {{ end }}
        </div>
        <span class="shrink-0 text-[11px] text-slate-600">{{ if .IgnoreDays }}‚àû{{ else }}{{ .Days }}d{{ end }}</span>
      </div>

      <div class="flex-1 min-h-0 p-1.5 lg:overflow-y-auto">
        {{ if .Error }}
        <div class="m-1 flex gap-2 rounded-sm border border-rose-300 bg-rose-100/70 p-2">
          <div class="flex-shrink-0 text-[16px]">‚ö†Ô∏è</div>
          <div class="break-words text-[11px] leading-snug text-rose-800">{{ .Error }}</div>
        </div>
        {{ else if .Items }}
        {{ range .Items }}
        <div class="mb-1 rounded-sm border border-transparent p-1.5 transition-colors hover:border-sky-400 hover:bg-slate-100">
          <div class="text-sm leading-tight">
            <a href="{{ .Link }}" target="_blank" rel="noopener noreferrer"
              class="block truncate font-medium text-sky-800 hover:text-sky-900 hover:underline visited:text-violet-800">{{ .Title }}</a>
          </div>
          {{ if not .HideDate }}
          <div class="mt-0.5 text-[11px] text-slate-600">{{ formatTimeAgo .Published }}</div>
          {{ end }}
        </div>
        {{ end }}
        {{ else }}
        <div class="py-6 text-center text-[11px] text-slate-600">No items</div>
        {{ end }}
      </div>
    </div>
    {{ end }}
    {{ else }}
    <div class="rounded-sm border border-slate-300 bg-slate-50 shadow-sm">
      <div class="flex-1 p-2">
        <div class="py-8 text-center text-sm text-slate-500">No sources configured</div>
      </div>
    </div>
    {{ end }}
  </div>

  <script>
    const eventSource = new EventSource('/events');

    eventSource.onmessage = function(event) {
      if (event.data === 'update') {
        window.location.reload();
      }
    };

    eventSource.onerror = function(error) {
      console.error('SSE error:', error);
      setTimeout(() => {
        window.location.reload();
      }, 5000);
    };
  </script>
</body>

</html>
